# Google ドライブ フォルダ監視システム V2 セットアップ手順書

この手順書は、プログラミング経験がない方でも設定できるように書かれています。
画面の指示に従って、順番に進めてください。

**サンプルスプレッドシート（参考用）**: https://docs.google.com/spreadsheets/d/1zS9AWg4DEpIIx0w4QaDm8RBFrLdmnNCjl6YFUd7QXSM/edit?usp=sharing

---

## 目次

1. [必要なもの](#1-必要なもの)
2. [スプレッドシートを作る](#2-スプレッドシートを作る)
3. [プログラムを貼り付ける](#3-プログラムを貼り付ける)
4. [初期セットアップを実行する](#4-初期セットアップを実行する)
5. [権限を許可する](#5-権限を許可する)
6. [監視するフォルダを登録する](#6-監視するフォルダを登録する)
7. [動作を確認する](#7-動作を確認する)
8. [自動実行を設定する](#8-自動実行を設定する)
9. [共有ドライブを使う場合](#9-共有ドライブを使う場合)
10. [困ったときは](#10-困ったときは)

---

## 1. 必要なもの

- Googleアカウント（GmailやGoogle ドライブが使えればOK）
- パソコン（スマホでは設定できません）
- 監視したいGoogle ドライブのフォルダ

---

## 2. スプレッドシートを作る

### 手順

1. **Google スプレッドシートを開く**
   - https://sheets.google.com にアクセス
   - Googleアカウントでログイン

2. **新しいスプレッドシートを作成**
   - 左上の「+」または「空白」をクリック

3. **名前をつける**
   - 左上の「無題のスプレッドシート」をクリック
   - 「ドライブ監視システム V2」など、わかりやすい名前に変更

---

## 3. プログラムを貼り付ける

### 手順

1. **Apps Scriptを開く**
   - スプレッドシートの上部メニューで「拡張機能」をクリック
   - 「Apps Script」をクリック
   - 新しいタブでエディタが開きます

2. **既存のコードを削除**
   - エディタに表示されている`function myFunction() { }`を全て選択（Ctrl+A または Cmd+A）
   - 削除（Delete または Backspace）

3. **新しいコードを貼り付け**
   - GitHubの`Code.gs`ファイルを開く: https://github.com/itoksk/drive-app/blob/main/Code.gs
   - 「Raw」ボタンをクリック
   - 全てを選択してコピー（Ctrl+A、Ctrl+C または Cmd+A、Cmd+C）
   - Apps Scriptエディタに戻って貼り付け（Ctrl+V または Cmd+V）

4. **保存する**
   - Ctrl+S または Cmd+S を押す
   - または、フロッピーディスクのアイコンをクリック

5. **プロジェクト名をつける（任意）**
   - 左上の「無題のプロジェクト」をクリック
   - 「ドライブ監視システム」など、わかりやすい名前に変更

---

## 4. 初期セットアップを実行する

### 手順

1. **スプレッドシートに戻る**
   - ブラウザのタブでスプレッドシートを開いているタブをクリック
   - または、スプレッドシートを再度開く

2. **ページを再読み込み**
   - F5キーを押す、または ブラウザの更新ボタンをクリック
   - これで「ドライブ監視」メニューが表示されます

3. **初期セットアップを実行**
   - 上部メニューに「ドライブ監視」が表示されているのを確認
   - 「ドライブ監視」→「初期セットアップ」をクリック

4. **完了を確認**
   - 「セットアップ完了」というメッセージが表示されればOK
   - mainシートにヘッダー行（青い行）が作成されます

---

## 5. 権限を許可する

初めて実行するとき、Googleから権限の確認画面が表示されます。
これは、プログラムがあなたのドライブやメールにアクセスするために必要です。

### 手順

1. **「承認が必要です」と表示されたら**
   - 「権限を確認」ボタンをクリック

2. **Googleアカウントを選択**
   - 自分のアカウントをクリック

3. **警告画面が表示されたら**
   - 「詳細」をクリック
   - 「（プロジェクト名）に移動（安全ではないページ）」をクリック

4. **権限を許可**
   - 「許可」ボタンをクリック

> **なぜ警告が出るの？**
> 自分で作ったプログラムはGoogleの審査を受けていないため、警告が表示されます。
> 自分で作成したプログラムなので、安全に使用できます。

---

## 6. 監視するフォルダを登録する

### 手順

1. **監視したいフォルダのURLをコピー**
   - Google ドライブで監視したいフォルダを開く
   - ブラウザのアドレスバーのURLを全て選択してコピー
   - 例: `https://drive.google.com/drive/folders/1ABC123...`

2. **スプレッドシートに入力**
   - mainシートの2行目に入力します：

   | 列 | 入力する内容 |
   |----|-------------|
   | A列 | チェックボックスをクリックしてONにする |
   | B列 | コピーしたフォルダのURLを貼り付け |
   | F列 | 通知を受け取るメールアドレス（自分のメールアドレス） |

3. **複数のフォルダを監視する場合**
   - 3行目、4行目...と追加していけばOK

---

## 7. 動作を確認する

### 手順

1. **手動でチェックを実行**
   - メニュー「ドライブ監視」→「今すぐチェック実行」をクリック

2. **結果を確認**
   - C列〜E列に自動で情報が入力されればOK
   - フォルダ名と同じ名前のシートが新しく作成されます
   - G列にエラーが表示されていないか確認

3. **メール通知をテスト**
   - 監視対象のフォルダに、何か新しいファイルを追加
   - もう一度「今すぐチェック実行」をクリック
   - メールが届けば成功！

> **ポイント**
> - 初回実行では、既存のファイルは登録されるだけでメールは届きません
> - 2回目以降に追加されたファイルがメール通知の対象になります

---

## 8. 自動実行を設定する

手動でチェックするのではなく、自動で定期的にチェックするように設定できます。

### 手順

1. **自動実行を設定**
   - メニュー「ドライブ監視」→「自動実行設定」を開く
   - 以下から選択：

   | 選択肢 | 説明 |
   |-------|------|
   | 1時間ごとに自動実行 | 頻繁にチェックしたい場合 |
   | 6時間ごとに自動実行 | バランスの良い設定（おすすめ） |
   | 毎日自動実行 | 毎朝9時にチェック |

2. **設定完了**
   - 「自動実行設定完了」と表示されればOK
   - 以降は自動でチェックされ、新しいファイルがあればメールが届きます

3. **自動実行を止めたいとき**
   - メニュー「ドライブ監視」→「自動実行設定」→「自動実行を停止」

---

## 9. 共有ドライブを使う場合

Google Workspace（会社や学校のGoogle）の共有ドライブを監視する場合は、追加の設定が必要です。

### 手順

1. **Apps Scriptを開く**
   - スプレッドシートで「拡張機能」→「Apps Script」

2. **Drive APIを追加**
   - 左側のメニューで「サービス」の横にある「+」をクリック
   - 一覧から「Drive API」を探す
   - 「Drive API」を選択して「追加」をクリック

3. **権限を再承認**
   - メニュー「ドライブ監視」→「今すぐチェック実行」をクリック
   - 再度権限の承認画面が表示されたら、許可する

これで共有ドライブのフォルダも監視できるようになります。

---

## 10. 困ったときは

### エラー：「フォルダIDが無効です」

**原因と対処法：**
- フォルダのURLが正しくコピーされていない → もう一度コピーし直す
- 共有ドライブのフォルダ → [9. 共有ドライブを使う場合](#9-共有ドライブを使う場合) を実行
- フォルダへのアクセス権限がない → フォルダの所有者に共有を依頼

### エラー：「メール送信エラー」

**原因と対処法：**
- 権限が承認されていない → Apps Scriptで`checkNewFiles`を実行し、権限を再承認
- メールアドレスが間違っている → F列のメールアドレスを確認

### シートが作成されない

**原因と対処法：**
- 権限が承認されていない → 権限を再承認
- フォルダにアクセスできない → フォルダのURLを確認

### メールが届かない

**原因と対処法：**
1. F列にメールアドレスが入力されているか確認
2. A列のチェックボックスがONになっているか確認
3. 迷惑メールフォルダを確認
4. **重要**: 初回実行ではメールは届きません。2回目以降に新しいファイルを追加してから実行してください

### 「ドライブ監視」メニューが表示されない

**原因と対処法：**
- ページを再読み込み（F5キー）してください
- コードが正しく保存されているか確認してください

---

## 参考リンク

- **サンプルスプレッドシート**: https://docs.google.com/spreadsheets/d/1zS9AWg4DEpIIx0w4QaDm8RBFrLdmnNCjl6YFUd7QXSM/edit?usp=sharing
- **GitHubリポジトリ**: https://github.com/itoksk/drive-app
- **元の記事（note）**: https://note.com/tyaperujp01/n/n66ac3a2dfe32

---

## お問い合わせ

不具合報告や質問は以下までお願いします：

- [GitHubのIssues](https://github.com/itoksk/drive-app/issues)
- [元のnote記事のコメント](https://note.com/tyaperujp01/n/n66ac3a2dfe32)

---

**最終更新日：2026年2月3日**
